//Sets initial class names for tags divs (add_recipe.html) depending
//on initial window size.
$(window).on("load", e => {
  if ($(e.target).width() > 760) {
    $(".tags-div").addClass("checkbox");
    $("#tags-container").addClass("col-3 form-group mt-4 bmd-form-group");
  } else {
    $(".tags-div").addClass("col-4 pt2");
    $("#tags-container").addClass("row mx-4 px-sm-5");
  }
});

$(document).ready(() => {
  let ing = 100; //100 set to ensure no clash with wtform id's
  $("#add_ingredient").click(() => {
    let newLi = $('<li class="list-group-item form-group">');
    // creates a new input with id and name to allow wtforms to
    // recognise the input for correct posting to db.
    // autocomplete=off and type=search stop browser from messing with form style
    newLi
      .after()
      .html(
       
        '<label for="ingredients-' +
          ing +
          '"></label>' +
          '<span class="bmd-group-item is-filled"><input class="form-control form-control-sm" type="search" autocomplete="off" name="ingredients-' +
          ing +
          '" id="ingredients-' +
          ing +
          '" value="" ></span>'
      );
    newLi.appendTo("#ingredients");

    ing++;
  });

  // delegates the event handler to #ingredients, allowing dynamically
  // generated ingredient inputs to register events.
  // checks length of input, removing the grandparent 'li' element if empty.
  $("#ingredients").on("keyup", "li", e => {
    if ($(e.target).val().length == 0) {
      $(e.target)
        .parent()
        .parent()
        .remove();
    }
  });

  //give classes to elements generated by wtforms.
  $("#ingredients")
    .children()
    .addClass("list-group-item form-group");
  $("li.list-group-item")
    .find("input")
    .addClass("form-control form-control-sm")
    .attr("autocomplete", "off") //stops browser autocomplete which messes up the form styling
    .attr("type", "search");

  //layout of the tags section in add_recipe.html requires divs to have different class
  //names. This function changes class names based on the window being resiez by user.
  //Initial class names are provided at the top of this file, outside the document.ready func.
  $(window).on("resize", e => {
    if ($(e.target).width() > 760) {
      $(".tags-div")
        .removeClass("col-4 pt2")
        .addClass("checkbox");
      $("#tags-container")
        .removeClass("row mx-4")
        .addClass("col-3 form-group mt-4 bmd-form-group");
    } else {
      $(".tags-div")
        .removeClass("checkbox")
        .addClass("col-4 pt-2");
      $("#tags-container")
        .removeClass("col-3 form-group mt-4 bmd-form-group")
        .addClass("row mx-4");
    }
  });
});
